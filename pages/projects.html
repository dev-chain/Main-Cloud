<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
    <link rel="shortcut icon" href="../assets/img/wicon.png">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Wakanda</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />

    <link href="../assets/css/dashboard/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap core CSS     -->
    <link href="../assets/css/dashboard/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="../assets/css/dashboard/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="../assets/css/general/loading-spinner.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/bootstrap-wakanda.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/wakanda.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/buttons.css" rel="stylesheet"/>

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="../assets/css/dashboard/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="../assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="../assets/css/dashboard/pe-icon-7-stroke.css" rel="stylesheet" />
</head>
<body onload="loadProjects()">

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-5.jpg">
        <div class="sidebar-wrapper" data-include="menu">
        </div>
    </div>

    <div class="main-panel">
		<nav class="navbar navbar-default navbar-fixed" data-include="navbar">
        </nav>

        <div class="content">
            <div class="container-fluid projectForm">
                <div class="row">
                    <div id="projectsArea" class="col-md-4">
                        <div class="card" >
                            <div class="header">
                                <h4 class="title">Projects </h4>
                                <button class="button button-royal button-circle button-small"
                                        style="position: absolute; right: 30px; margin-top:-28px;"
                                        onclick="addProject()">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            <div class="content">
                                <div id="projectsRow" class="row">
                                    <div class="projectsLoading sk-cube-grid">
                                        <div class="sk-cube sk-cube1"></div>
                                        <div class="sk-cube sk-cube2"></div>
                                        <div class="sk-cube sk-cube3"></div>
                                        <div class="sk-cube sk-cube4"></div>
                                        <div class="sk-cube sk-cube5"></div>
                                        <div class="sk-cube sk-cube6"></div>
                                        <div class="sk-cube sk-cube7"></div>
                                        <div class="sk-cube sk-cube8"></div>
                                        <div class="sk-cube sk-cube9"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="newProjectArea" class="col-md-8" style="display:none">
                        <div id="newProjectCard" class="card" >
                            <div class="header">
                                <h4 id="newProjectCardTitle" class="title">Create new project</h4>
                            </div>
                            <div class="content">
                                <form>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Company</label>
                                                <input id="company" type="text" class="form-control" placeholder="Company" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Project name</label>
                                                <input id="projectName" type="text" class="form-control" placeholder="Project" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Main Programming Language</label>
                                                <input id="programmingLanguage" type="text" class="form-control" placeholder="Java, NodeJS, Python or any other" value="">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>City</label>
                                                <input id="city" type="text" class="form-control" placeholder="City" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Country</label>
                                                <input id="country" type="text" class="form-control" placeholder="Country" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Postal Code</label>
                                                <input id="zipcode" type="number" class="form-control" placeholder="ZIP Code">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Api Key</label>
                                                <input id="apiKey" type="text" class="form-control" disabled value="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Encrypt Key</label>
                                                <input id="encryptKey" type="text" class="form-control" disabled value="">
                                            </div>
                                        </div>
                                    </div>

                                    <button type="button" style="margin-left:4px;" class="btn btn-danger btn-fill pull-right" onclick="deleteProject()">Delete</button>
                                    <button type="button" style="margin-left:4px;" class="btn btn-info btn-fill pull-right" onclick="hideCreateProjectArea()">Close</button>
                                    <button type="button" class="btn btn-info btn-fill pull-right" onclick="createProject()">Create</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer" data-include="footer">
        </footer>


    </div>
</div>
</body>
    <script>
        function loadProjects() {
            let addProjectsOnList = function (data) {
                let array = JSON.parse(data);
                array.forEach(function (element, index) {
                    addProjectRow(element.company + " / " + element.name, element);
                });
            };

            let showHelp = function () {
                const text = "Hi, on this page you will manage your projects, you can have 2 projects for account, " +
                "if you want more you can upgrade to PRO." +
                "<br><br>To create a new new project click on plus button on your left."
                demo.showNotification('top', 'right', text);
            };

            var successLoadProjects = function (status, data) {
                $('.projectsLoading').remove();
                if (status !== "nocontent") {
                    addProjectsOnList(data);
                } else {
                    showHelp();
                }
            };

            $.ajax({
                method: 'GET',
                url: RestAPI.projects,
                crossDomain: true,
                headers: {
                    "content-type": "application/x-www-form-urlencoded",
                    "cache-control": "no-cache"
                },
                data: {
                    email: sessionStorage.getItem('wakanda-user-email'),
                    token: sessionStorage.getItem('wakanda-user-token')
                }
            }).success(function(data, status) {
                successLoadProjects(status, data);
            }).error(function(jqXHR, textStatus, response, thrownError) {
                if(response.statusCode === 401) {
                    redirectIndex();
                }
            });
        }

        function isJson(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }

        function addProjectRow(projectName, project) {
            var projectContainer = $('<div>');
            projectContainer.addClass('card cardProjectInfo');
            var projectLine = $('<div>');
            projectLine.attr('align', 'left').addClass('projectInfo');
            projectLine.html(projectName);

            var editButton = $('<a>');
            editButton.addClass('projectInfoEdit');
            editButton.bind('click', function() {
                viewProject(project);
            });
            editButton.html("View");

            projectLine.append(editButton);
            projectContainer.append(projectLine);
            $('#projectsRow').append(projectContainer);
        };

        function closeHelpMessage() {
            $('.close').click();
            $('.projectForm').show();
        };
        function addProject() {
            closeHelpMessage();
            $('#newProjectCardTitle').html("Create new project");
            $('#newProjectArea').fadeIn();
        }

        var afterSuccessOnCreateProject = function () {
            demo.showNotification('top', 'left', "Congratulations, you create a new project, your server its not ready yet, wait few minutes, we are working on that, you will be notified when its finished.");
        };

        function hideCreateProjectArea() {
            let $newProjectArea = $('#newProjectArea');
            $newProjectArea.fadeOut(400, function() {
                $newProjectArea.hide();
            });

        }

        function viewProject(project) {
            $('#newProjectCardTitle').html("Project Visualization");
            $('#projectName').val(project.name);
            $('#company').val(project.company);
            $('#zipcode').val(project.zipcode);
            $('#country').val(project.country);
            $('#city').val(project.city);
            $('#programmingLanguage').val(project.programmingLanguage);
            $('#apiKey').val(project.apiKey);
            $('#encryptKey').val(project.decryptKey);
            $('#newProjectArea').fadeIn();
        }

        function deleteProject() {
            let settings = {
                "async": true,
                "crossDomain": true,
                "url": RestAPI.projects,
                "method": "DELETE",
                "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                "data": JSON.stringify({
                    ownerEmail: sessionStorage.getItem('wakanda-user-email'),
                    token: sessionStorage.getItem('wakanda-user-token'),
                    apiKey: $('#apiKey').val(),
                })
            };

            $.ajax(settings).success(function (logs) {
                demo.showNotification('top', 'left', "Ok, your app will be deleted, wait some seconds for him disappear.");
                hideCreateProjectArea();
            }).error(function(jqxHR, textStatus, response) {
                if(response.statusCode === 401) {
                    redirectIndex();
                } else {
                    demo.showNotification('top', 'left', "Oops, we're having problems, please try again later.");
                }

            });
        }

        function createProject() {
            var projectName = $('#projectName').val();
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": RestAPI.generateHerokuInstance,
                "method": "POST",
                "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                "data": JSON.stringify({
                    ownerEmail: sessionStorage.getItem('wakanda-user-email'),
                    token: sessionStorage.getItem('wakanda-user-token'),
                    name: projectName,
                    company: $('#company').val(),
                    zipcode: $('#zipcode').val(),
                    country: $('#country').val(),
                    city: $('#city').val(),
                    programmingLanguage: $('#programmingLanguage').val(),
                })
            };

            $.ajax(settings).success(function (logs) {
                afterSuccessOnCreateProject();
                hideCreateProjectArea();
            }).error(function(jqxHR, textStatus, response) {
                if(response.statusCode === 401) {
                    redirectIndex();
                } else {
                    demo.showNotification('top', 'left', "Oops, we're having problems, please try again later.");
                    $('#newProjectCard').hide();
                }
            });
        }
    </script>
    <!--   Core JS Files   -->
    <script src="../assets/js/general/jquery-1.11.1.js" type="text/javascript"></script>
	<script src="../assets/js/dashboard/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="../assets/js/dashboard/bootstrap-checkbox-radio-switch.js"></script>

	<!--  Charts Plugin -->
	<script src="../assets/js/dashboard/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="../assets/js/dashboard/bootstrap-notify.js"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="../assets/js/dashboard/bootstrap-wakanda.js"></script>
    <script src="../assets/js/general/restapi.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="../assets/js/dashboard/demo.js"></script>


</html>