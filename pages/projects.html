<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
    <link rel="shortcut icon" href="../assets/img/wicon.png">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Wakanda</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />

    <link href="../assets/css/dashboard/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap core CSS     -->
    <link href="../assets/css/dashboard/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="../assets/css/dashboard/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="../assets/css/general/loading-spinner.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/bootstrap-wakanda.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/wakanda.css" rel="stylesheet"/>
    <link href="../assets/css/dashboard/buttons.css" rel="stylesheet"/>

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="../assets/css/dashboard/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="../assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="../assets/css/dashboard/pe-icon-7-stroke.css" rel="stylesheet" />
</head>
<body onload="loadProjects()">

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-5.jpg">
        <div class="sidebar-wrapper" data-include="menu">
        </div>
    </div>

    <div class="main-panel">
		<nav class="navbar navbar-default navbar-fixed" data-include="navbar">
        </nav>

        <div class="content">
            <div class="container-fluid projectForm">
                <div class="row">
                    <div id="projectsArea" class="col-md-4">
                        <div class="card" >
                            <div class="header" >
                                <h4 class="title">
                                    <data i18n="projects"></data>
                                </h4>
                                <button id="addProjectBtn" class="button button-royal button-circle button-small"
                                        style="position: absolute; right: 30px; margin-top:-28px;"
                                        onclick="addProject()">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            <div class="content">
                                <div id="projectsRow" class="row">
                                    <div class="projectsLoading sk-cube-grid">
                                        <div class="sk-cube sk-cube1"></div>
                                        <div class="sk-cube sk-cube2"></div>
                                        <div class="sk-cube sk-cube3"></div>
                                        <div class="sk-cube sk-cube4"></div>
                                        <div class="sk-cube sk-cube5"></div>
                                        <div class="sk-cube sk-cube6"></div>
                                        <div class="sk-cube sk-cube7"></div>
                                        <div class="sk-cube sk-cube8"></div>
                                        <div class="sk-cube sk-cube9"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="newProjectArea" class="col-md-8" style="display:none">
                        <div id="newProjectCard" class="card" >
                            <div class="header">
                                <h4 id="newProjectCardTitle" class="title">
                                    <data i18n="create_new_project"></data>
                                </h4>
                            </div>
                            <div class="content">
                                <form>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="company"></label>
                                                <input id="company" type="text" class="form-control" placeholder_i18n="Company" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="project_name"></label>
                                                <input id="projectName" type="text" class="form-control" placeholder_i18n="Project" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="main_programming_language"></label>
                                                <input id="programmingLanguage" type="text" class="form-control" placeholder="Example: Java, NodeJS, Python" value="">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="city"></label>
                                                <input id="city" type="text" class="form-control" placeholder_i18n="City" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="country"></label>
                                                <input id="country" type="text" class="form-control" placeholder_i18n="Country" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label i18n="postal_code"></label>
                                                <input id="zipcode" type="number" class="form-control" placeholder_i18n="Postal_code">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6" style="z-index:300">
                                            <div class="form-group">
                                                <label i18n="api_key"></label>
                                                <table width="100%">
                                                    <tr>
                                                        <td>
                                                            <input id="apiKey" type="text" class="form-control" disabled value="">
                                                        </td>
                                                        <td align="center" style="cursor:pointer" onclick="copyToClipboard(document.getElementById('apiKey').value)">
                                                            <span class="fa fa-copy"></span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-md-6" style="z-index:300">
                                            <div class="form-group">
                                                <label i18n="encrypt_key"></label>
                                                <table width="100%">
                                                    <tr>
                                                        <td>
                                                            <input id="encryptKey" type="text" class="form-control" disabled value="">
                                                        </td>
                                                        <td align="center" style="cursor:pointer" onclick="copyToClipboard(document.getElementById('encryptKey').value)">
                                                            <span class="fa fa-copy"></span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="button" style="margin-left:4px;" class="btn btn-danger btn-fill pull-right" onclick="deleteProject()">
                                        <data i18n="delete"></data>
                                    </button>
                                    <button type="button" style="margin-left:4px;" class="btn btn-info btn-fill pull-right" onclick="hideCreateProjectArea()">
                                        <data i18n="close"></data>
                                    </button>
                                    <button type="button" class="btn btn-info btn-fill pull-right" id="createProjectBtn" onclick="createProject()">
                                        <data i18n="create"></data>
                                    </button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer" data-include="footer">
        </footer>


    </div>
</div>
</body>
    <script>
        function loadProjects() {
            let addProjectsOnList = function (data) {
                let array = JSON.parse(data);
                array.forEach(function (element, index) {
                    addProjectRow(element.company + " / " + element.name, element);
                });
            };

            var successLoadProjects = function (status, data) {
                $('.projectsLoading').remove();
                if (status !== "nocontent") {
                    addProjectsOnList(data);
                } else {
                    ProjectHelper.run(ProjectHelper.anyProjectRegistered);
                }
            };

            $.ajax({
                method: 'GET',
                url: RestAPI.projects,
                crossDomain: true,
                headers: {
                    "content-type": "application/x-www-form-urlencoded",
                    "cache-control": "no-cache"
                },
                data: {
                    email: sessionStorage.getItem('wakanda-user-email'),
                    token: sessionStorage.getItem('wakanda-user-token')
                }
            }).success(function(data, status) {
                successLoadProjects(status, data);
            }).error(function(jqXHR, textStatus, response, thrownError) {
                if(response.statusCode === 401) {
                    redirectIndex();
                }
            });
        }

        function isJson(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }

        function addProjectRow(projectName, project) {
            var projectContainer = $('<div>');
            projectContainer.addClass('card cardProjectInfo');
            var projectLine = $('<div>');
            projectLine.attr('align', 'left').addClass('projectInfo');
            projectLine.html(projectName);

            var editButton = $('<a>');
            editButton.addClass('projectInfoEdit');
            editButton.bind('click', function() {
                viewProject(project);
            });
            editButton.html(i18n("view"));

            projectLine.append(editButton);
            projectContainer.append(projectLine);
            $('#projectsRow').append(projectContainer);
        };

        function closeHelpMessage() {
            $('.close').click();
            $('.projectForm').show();
        };
        function addProject() {
            closeHelpMessage();

            $('#projectName').val("");
            $('#company').val("");
            $('#zipcode').val("");
            $('#country').val("");
            $('#city').val("");
            $('#programmingLanguage').val("");
            $('#apiKey').val("");
            $('#encryptKey').val("");

            $('#newProjectCardTitle').html(i18n("create_new_project"));
            $('#newProjectArea').fadeIn();
            $('#createProjectBtn').show();
        }

        var afterSuccessOnCreateProject = function () {
            demo.showNotification('top', 'right', i18n("message_success_create_project"), 'success');
        };

        function hideCreateProjectArea() {
            let $newProjectArea = $('#newProjectArea');
            $newProjectArea.fadeOut(400, function() {
                $newProjectArea.hide();
            });

        }

        function viewProject(project) {
            $('#newProjectCardTitle').html(i18n("project_visualization"));
            $('#projectName').val(project.name);
            $('#company').val(project.company);
            $('#zipcode').val(project.zipcode);
            $('#country').val(project.country);
            $('#city').val(project.city);
            $('#programmingLanguage').val(project.programmingLanguage);
            $('#apiKey').val(project.apiKey);
            $('#encryptKey').val(project.decryptKey);
            $('#newProjectArea').fadeIn();
            $('#createProjectBtn').hide();
            setTimeout(function() {
                ProjectHelper.run(ProjectHelper.createFirstProject);
            }, 1000);

        }

        function deleteProject() {
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": RestAPI.projects + "?email=" + sessionStorage.getItem("wakanda-user-email")
                                        + "&token=" + sessionStorage.getItem("wakanda-user-token")
                                        +" &apiKey=" + $('#apiKey').val(),
                "method": "DELETE"
            }

            $.ajax(settings).success(function (logs) {
            }).error(function(jqxHR, textStatus, response) {
                if(response.statusCode === 401) {
                    redirectIndex();
                } else {
                    demo.showNotification('top', 'right', i18n("message_problems_try_again_later"), 'danger');
                }

            });

            demo.showNotification('top', 'right', i18n("message_app_deleted"), 'success');
            hideCreateProjectArea();
        }

        function createProject() {
            var projectName = $('#projectName').val();
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": RestAPI.generateHerokuInstance,
                "method": "POST",
                "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                "data": JSON.stringify({
                    ownerEmail: sessionStorage.getItem('wakanda-user-email'),
                    token: sessionStorage.getItem('wakanda-user-token'),
                    name: projectName,
                    company: $('#company').val(),
                    zipcode: $('#zipcode').val(),
                    country: $('#country').val(),
                    city: $('#city').val(),
                    programmingLanguage: $('#programmingLanguage').val(),
                })
            };

            $.ajax(settings).success(function (logs) {
            }).error(function(jqxHR, textStatus, response) {
                if(response.statusCode === 401) {
                    redirectIndex();
                } else {
                    demo.showNotification('top', 'right', i18n("message_problems_try_again_later"), 'danger');
                }
            });

            afterSuccessOnCreateProject();
            hideCreateProjectArea();
        }
    </script>
    <!--   Core JS Files   -->
    <script src="../assets/js/general/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../assets/i18n/i18.js"></script>
	<script src="../assets/js/dashboard/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="../assets/js/dashboard/bootstrap-checkbox-radio-switch.js"></script>

	<!--  Charts Plugin -->
	<script src="../assets/js/dashboard/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="../assets/js/dashboard/bootstrap-notify.js"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="../assets/js/dashboard/bootstrap-wakanda.js"></script>
    <script src="../assets/js/general/restapi.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="../assets/js/dashboard/demo.js"></script>

    <script src="../assets/js/help/helper-libs.js"></script>
    <script src="../assets/js/help/projects-help.js"></script>

</html>