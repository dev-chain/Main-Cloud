<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
    <link rel="shortcut icon" href="../assets/img/wicon.png">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Wakanda</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="../assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="../assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>
    <link href="../assets/css/wakanda.css" rel="stylesheet"/>
    <link href="../assets/css/buttons.css" rel="stylesheet"/>
    <link href="../assets/css/loading-spinner.css" rel="stylesheet"/>

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="../assets/css/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="../assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
</head>
<body onload="loadProjects()">

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-5.jpg">
        <div class="sidebar-wrapper" data-include="menu">
        </div>
    </div>

    <div class="main-panel">
		<nav class="navbar navbar-default navbar-fixed" data-include="navbar">
        </nav>

        <div class="content">
            <div class="container-fluid projectForm">
                <div class="row">
                    <div id="projectsArea" class="col-md-4">
                        <div class="card" >
                            <div class="header">
                                <h4 class="title">Projects </h4>
                                <button class="button button-action button-circle button-small"
                                        style="position: absolute; right: 30px; margin-top:-28px;"
                                        onclick="addProject()">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            <div class="content">
                                <div id="projectsRow" class="row">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="newProjectArea" class="col-md-8">
                        <div class="help-message">
                            <p>
                                Hi, on this page you will manage your projects, you can have 2 projects for account, if you want more you can upgrade to PRO.
                                <br>To create a new new project click on plus button on your left.
                            </p>
                        </div>
                        <div id="loadingCreateProject" style="display:none">
                            <div class="loading-spinner card" style="min-height:400px">
                                <span class="loadingProject" style="margin-left:55px;color:#943bea;font-size:30px;">
                                    Your project is being created, please wait...
                                </span>
                                <div class="loadingProject sk-cube-grid">
                                    <div class="sk-cube sk-cube1"></div>
                                    <div class="sk-cube sk-cube2"></div>
                                    <div class="sk-cube sk-cube3"></div>
                                    <div class="sk-cube sk-cube4"></div>
                                    <div class="sk-cube sk-cube5"></div>
                                    <div class="sk-cube sk-cube6"></div>
                                    <div class="sk-cube sk-cube7"></div>
                                    <div class="sk-cube sk-cube8"></div>
                                    <div class="sk-cube sk-cube9"></div>
                                </div>
                                <div id="createAppLog" class="card"
                                     style="min-height:230px;width:95%;margin-left:15px
                                            ;font-size:11px;overflow-y:auto;padding-left:8px;max-height:230px;
                                            display: flex;
                                            flex-direction: column-reverse;">
                                </div>
                            </div>
                        </div>

                        <div id="newProjectCard" class="card" style="display:none">
                            <div class="header">
                                <h4 class="title">Create new project</h4>
                            </div>
                            <div class="content">
                                <form>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Company</label>
                                                <input id="company" type="text" class="form-control" placeholder="Company" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Project name</label>
                                                <input id="projectName" type="text" class="form-control" placeholder="Project" value="">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Decrypt Key (8 characters)</label>
                                                <input id="decryptKey" type="text" class="form-control" placeholder="xOpT89t4">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Security Token </label>
                                                <input id="securityToken" type="text" class="form-control" placeholder="yellowegg" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Main Programming Language</label>
                                                <input id="programmingLanguage" type="text" class="form-control" placeholder="Java / NodeJS" value="">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>City</label>
                                                <input id="city" type="text" class="form-control" placeholder="City" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Country</label>
                                                <input id="country" type="text" class="form-control" placeholder="Country" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Postal Code</label>
                                                <input id="zipcode" type="number" class="form-control" placeholder="ZIP Code">
                                            </div>
                                        </div>
                                    </div>

                                    <button type="button" class="btn btn-info btn-fill pull-right" onclick="createProject()">Create</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer" data-include="footer">
        </footer>


    </div>
</div>
</body>
    <script>
        function loadProjects() {
            $.ajax({
                method: 'GET',
                url: 'https://wakandaserver.herokuapp.com/getProjects',
                crossDomain: true,
                headers: {
                    "content-type": "application/x-www-form-urlencoded",
                    "cache-control": "no-cache"
                },
                data: {
                    email: $('#emailUser').html(),
                    token: "a"
                }
            }).success(function(data, status) {
                if(status !== "nocontent") {
                   closeHelpMessage();
                    JSON.parse(data).forEach(function (element, index) {
                        addProjectRow(element.company + " / " + element.name);
                    });
                }
            }).error(function(jqXHR, textStatus, ajaxSettings, thrownError) {
            });
        }

        function addProjectRow(projectName) {
            var projectContainer = $('<div>');
            projectContainer.addClass('card cardProjectInfo');
            var projectLine = $('<div>');
            projectLine.attr('align', 'left').addClass('projectInfo');
            projectLine.html(projectName);
            var editButton = $('<editButton>');
            editButton.addClass("projectInfoEdit");
            editButton.html('<a href="">Editar</a>');
            projectLine.append(editButton);
            projectContainer.append(projectLine);
            $('#projectsRow').append(projectContainer);
        };

        function closeHelpMessage() {
            $('.help-message').hide();
            $('.projectForm').show();
        };
        function addProject() {
            closeHelpMessage();
            $('#newProjectCard').show();
        }

        var afterSuccessOnCreateProject = function () {
            $('#loadingCreateProject').hide();
            $('#createAppLog').hide();
            $('.help-message').show();
            $('.help-message p').html("Congratulations, you create your first project, now you can ever came to this page to: " +
                                     "<br><br> - Update any project data on edit button in left side of your screen." +
                                     "<br> - Add new projects on plus button on your left, remember you can create at most 2 projects without PRO.");

            var projectName = $('#projectName').val();
            addProjectRow(projectName);
        };

        var logInterval;

        function createProject() {
            $('#newProjectCard').hide();
            $('#loadingCreateProject').show();
            var projectName = $('#projectName').val();
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "https://wakandaserver.herokuapp.com/generate",
                "method": "POST",
                "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                "data": JSON.stringify({
                    ownerEmail: $('#emailUser').html(),
                    name: projectName,
                    company: $('#company').val(),
                    zipcode: $('#zipcode').val(),
                    country: $('#country').val(),
                    city: $('#city').val(),
                    decryptKey: $('#decryptKey').val(),
                    securityToken: $('#securityToken').val(),
                    programmingLanguage: $('#programmingLanguage').val(),
                })
            };

            logInterval = setInterval(function() {
                $.ajax({
                    method: 'GET',
                    url: 'https://wakandaserver.herokuapp.com/getLogs',
                    crossDomain: true,
                    headers: {
                        "content-type": "application/x-www-form-urlencoded",
                        "cache-control": "no-cache"
                    },
                    data: {
                        email: $('#emailUser').html(),
                        token: ""
                    }
                }).success(function(data) {
                   $('#createAppLog').append(data.replace("\n", "<br>").replace("\t", "<br>").replace("\r", "<br>"));
                });
            }, 1000);

            $.ajax(settings).success(function (logs) {
                setTimeout(function() {
                    clearInterval(logInterval);
                    afterSuccessOnCreateProject();
                }, 1000);
            }).error(function() {
                alert('Ops aconteceu algum erro' + response);
            });
        }
    </script>
    <!--   Core JS Files   -->
    <script src="../assets/js/jquery-1.10.2.js" type="text/javascript"></script>
	<script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="../assets/js/bootstrap-checkbox-radio-switch.js"></script>

	<!--  Charts Plugin -->
	<script src="../assets/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="../assets/js/bootstrap-notify.js"></script>

    <!--  Google Maps Plugin    -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="../assets/js/light-bootstrap-dashboard.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="../assets/js/demo.js"></script>


</html>